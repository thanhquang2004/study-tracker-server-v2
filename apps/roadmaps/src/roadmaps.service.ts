import { GoogleGenerativeAI } from '@google/generative-ai';
import { Injectable, NotFoundException } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';
import { PrismaService } from './prisma/prisma.service';
import { GenerateQuestionRequestDto } from './dto/generateQuestionRequest.dto';

@Injectable()
export class RoadmapsService {
  private genAI: any;

  constructor(
    private readonly configService: ConfigService,
    private readonly prismaService: PrismaService,
  ) {
    this.genAI = new GoogleGenerativeAI(
      this.configService.get('GOOGLE_API_KEY'),
    );
  }

  async generateQuestion(generateQuestionRequest: GenerateQuestionRequestDto) {
    const model = this.genAI.getGenerativeModel({
      model: 'gemini-1.5-flash-8b',
    });

    const generationConfig = {
      temperature: 0.8,
      topP: 0.95,
      topK: 40,
      maxOutputTokens: 8192,
      responseMimeType: 'application/json',
    };

    console.log('Generating question with info:', generateQuestionRequest.info);
    const parts = [
      {
        text: "input: Based on the following information: [Want to study: Guitar], generate a follow-up assessment question to determine the user's proficiency level. The question should help identify specific skills or knowledge areas related to Guitar, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ],\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'What is your current skill level with the guitar?',\n  'info': 'Guitar Skill Level',\n  'suggestAnswer': [\n    {'content': 'Beginner - I have never played'},\n    {'content': 'Intermediate - I know a few chords and songs'},\n    {'content': 'Advanced - I can play complex songs and improvise'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Guitar; Guitar Skill Level: Beginner - I have never played], generate a follow-up assessment question to determine specific skills or techniques related to Guitar. The question should help assess the user's familiarity with basic techniques, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with basic guitar chords (e.g., G, C, D)?',\n  'info': 'Basic Chords Familiarity',\n  'suggestAnswer': [\n    {'content': 'No, I am not familiar'},\n    {'content': 'Yes, I know a few basic chords'},\n    {'content': 'Yes, I am comfortable with most common chords'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Guitar; Guitar Skill Level: Beginner - I have never played; Basic Chords Familiarity: No, I am not familiar], generate a follow-up assessment question to explore fingerstyle or strumming preferences. The question should help assess which playing style the user is interested in, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Which guitar playing style are you most interested in learning?',\n  'info': 'Preferred Playing Style',\n  'suggestAnswer': [\n    {'content': 'Fingerstyle'},\n    {'content': 'Strumming with a pick'},\n    {'content': 'Not sure, I want to try both'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Guitar; Guitar Skill Level: Beginner - I have never played; Basic Chords Familiarity: No, I am not familiar; Preferred Playing Style: Fingerstyle], generate a follow-up assessment question to determine your interest in learning musical theory. The question should help assess whether the user prefers practical skills over theoretical knowledge, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you interested in learning music theory along with guitar techniques?',\n  'info': 'Interest in Music Theory',\n  'suggestAnswer': [\n    {'content': 'Yes, I want to learn the theory'},\n    {'content': 'No, I prefer to focus on practical skills only'},\n    {'content': 'Maybe, I am open to both'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Guitar; Guitar Skill Level: Beginner - I have never played; Basic Chords Familiarity: No, I am not familiar; Preferred Playing Style: Fingerstyle; Interest in Music Theory: Yes, I want to learn the theory], generate a follow-up assessment question to determine the user's familiarity with tuning and maintaining a guitar. The question should help assess basic technical knowledge and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with how to tune and maintain your guitar?',\n  'info': 'Tuning and Maintenance Knowledge',\n  'suggestAnswer': [\n    {'content': 'No, I do not know how to tune or maintain'},\n    {'content': 'Yes, I can tune but I need help with maintenance'},\n    {'content': 'Yes, I know how to tune and maintain properly'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Piano], generate a follow-up assessment question to determine the user's proficiency level. The question should help identify specific skills or knowledge areas related to Piano, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'What is your current level of piano playing experience?',\n  'info': 'Piano Skill Level',\n  'suggestAnswer': [\n    {'content': 'Beginner - I have never played piano'},\n    {'content': 'Intermediate - I can play simple songs'},\n    {'content': 'Advanced - I can read sheet music and play complex pieces'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Piano; Piano Skill Level: Beginner - I have never played piano], generate a follow-up assessment question to determine specific skills or techniques related to piano. The question should help assess the user's familiarity with basic piano knowledge, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with basic piano finger positioning?',\n  'info': 'Basic Piano Finger Positioning',\n  'suggestAnswer': [\n    {'content': 'No, I am not familiar'},\n    {'content': 'Yes, I know the basics but need practice'},\n    {'content': 'Yes, I am comfortable with finger positioning'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Piano; Piano Skill Level: Beginner - I have never played piano; Basic Piano Finger Positioning: No, I am not familiar], generate a follow-up assessment question to explore your interest in learning music theory. The question should help assess whether the user prefers theoretical knowledge along with practical piano skills, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Would you like to learn music theory alongside piano techniques?',\n  'info': 'Interest in Music Theory',\n  'suggestAnswer': [\n    {'content': 'Yes, I want to learn music theory'},\n    {'content': 'No, I prefer to focus on playing'},\n    {'content': 'Maybe, I am open to learning both'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Drawing], generate a follow-up assessment question to determine the user's drawing experience level. The question should help identify specific skills or knowledge areas related to Drawing, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'What is your current drawing experience level?',\n  'info': 'Drawing Experience Level',\n  'suggestAnswer': [\n    {'content': 'Beginner - I have never practiced drawing seriously'},\n    {'content': 'Intermediate - I draw regularly, but need improvement'},\n    {'content': 'Advanced - I can draw detailed pieces and use techniques confidently'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Drawing; Drawing Experience Level: Beginner - I have never practiced drawing seriously], generate a follow-up assessment question to determine the user’s familiarity with basic drawing techniques like shading and sketching. The question should help assess technical skills and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with basic drawing techniques such as sketching and shading?',\n  'info': 'Basic Drawing Techniques',\n  'suggestAnswer': [\n    {'content': 'No, I am not familiar with these techniques'},\n    {'content': 'Yes, I know the basics but need more practice'},\n    {'content': 'Yes, I am comfortable with sketching and shading'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Drawing; Drawing Experience Level: Beginner - I have never practiced drawing seriously; Basic Drawing Techniques: No, I am not familiar with these techniques], generate a follow-up assessment question to explore the user’s interest in learning anatomy drawing or landscape drawing. The question should help assess interest in different drawing subjects and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you more interested in learning anatomy drawing or landscape drawing?',\n  'info': 'Preferred Drawing Subject',\n  'suggestAnswer': [\n    {'content': 'Anatomy drawing'},\n    {'content': 'Landscape drawing'},\n    {'content': 'I want to explore both'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Drawing; Drawing Experience Level: Beginner - I have never practiced drawing seriously; Basic Drawing Techniques: No, I am not familiar with these techniques; Preferred Drawing Subject: Anatomy drawing], generate a follow-up assessment question to explore the user's familiarity with drawing tools like pencils, charcoal, or digital tools. The question should help assess knowledge of different tools and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Which drawing tools are you most comfortable using (e.g., pencils, charcoal, digital)?',\n  'info': 'Familiarity with Drawing Tools',\n  'suggestAnswer': [\n    {'content': 'Pencils'},\n    {'content': 'Charcoal'},\n    {'content': 'Digital tools'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Drawing; Drawing Experience Level: Beginner - I have never practiced drawing seriously; Basic Drawing Techniques: No, I am not familiar with these techniques; Preferred Drawing Subject: Anatomy drawing; Familiarity with Drawing Tools: Pencils], generate a follow-up assessment question to determine the user’s familiarity with perspective drawing techniques. The question should help assess technical skills and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with perspective drawing techniques (e.g., vanishing points, horizon lines)?',\n  'info': 'Perspective Drawing Knowledge',\n  'suggestAnswer': [\n    {'content': 'No, I am not familiar with perspective drawing'},\n    {'content': 'Yes, I know the basics but need more practice'},\n    {'content': 'Yes, I am comfortable with perspective drawing'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: English], generate a follow-up assessment question to determine the user's English proficiency level. The question should help identify specific skills or knowledge areas related to English, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'What is your current level of English proficiency?',\n  'info': 'English Proficiency Level',\n  'suggestAnswer': [\n    {'content': 'Beginner - I know basic words and phrases'},\n    {'content': 'Intermediate - I can have simple conversations'},\n    {'content': 'Advanced - I can understand and discuss complex topics'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: English; English Proficiency Level: Beginner - I know basic words and phrases], generate a follow-up assessment question to determine the user's familiarity with English grammar. The question should help assess specific technical skills and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with basic English grammar rules (e.g., verb tenses, sentence structure)?',\n  'info': 'Grammar Familiarity',\n  'suggestAnswer': [\n    {'content': 'No, I am not familiar with grammar rules'},\n    {'content': 'Yes, I know some basic rules but need more practice'},\n    {'content': 'Yes, I am comfortable with basic grammar rules'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: React], generate a follow-up assessment question to determine the user's proficiency level. The question should help identify specific skills or knowledge areas related to React, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ],\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'What is your experience level with React development?',\n  'info': 'React Skill Level',\n  'suggestAnswer': [\n    {'content': 'Beginner - I have never used React'},\n    {'content': 'Intermediate - I can create basic React components'},\n    {'content': 'Advanced - I can build complex applications with React'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: React; React Skill Level: Beginner - I have never used React], generate a follow-up assessment question to determine familiarity with JSX syntax. The question should help assess whether the user is comfortable with JSX, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in ${info}",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with JSX syntax used in React?',\n  'info': 'JSX Familiarity',\n  'suggestAnswer': [\n    {'content': 'No, I am not familiar with JSX'},\n    {'content': 'Yes, I know what JSX is but need more practice'},\n    {'content': 'Yes, I am comfortable writing JSX'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: React; React Skill Level: Beginner - I have never used React; JSX Familiarity: No, I am not familiar with JSX], generate a follow-up assessment question to explore your experience with JavaScript ES6+. The question should help determine if the user needs foundational JavaScript knowledge before advancing in React. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with modern JavaScript (ES6+) features such as arrow functions, promises, and classes?',\n  'info': 'JavaScript ES6+ Knowledge',\n  'suggestAnswer': [\n    {'content': 'No, I am not familiar with ES6+'},\n    {'content': 'Yes, I know some ES6+ features but need practice'},\n    {'content': 'Yes, I am comfortable using modern JavaScript'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: React; React Skill Level: Beginner - I have never used React; JSX Familiarity: No, I am not familiar with JSX; JavaScript ES6+ Knowledge: No, I am not familiar with ES6+], generate a follow-up assessment question to explore knowledge of state and props in React. The question should help assess understanding of core React concepts, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Do you understand the concept of state and props in React components?',\n  'info': 'State and Props Knowledge',\n  'suggestAnswer': [\n    {'content': 'No, I am not familiar with state or props'},\n    {'content': 'Yes, I understand props but not state'},\n    {'content': 'Yes, I understand both state and props'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: React; React Skill Level: Beginner - I have never used React; JSX Familiarity: No, I am not familiar with JSX; JavaScript ES6+ Knowledge: No, I am not familiar with ES6+; State and Props Knowledge: No, I am not familiar with state or props], generate a follow-up assessment question to explore your knowledge of component lifecycle methods in React. The question should help assess familiarity with more advanced React features, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with React component lifecycle methods (e.g., componentDidMount, componentDidUpdate)?',\n  'info': 'Component Lifecycle Knowledge',\n  'suggestAnswer': [\n    {'content': 'No, I am not familiar with lifecycle methods'},\n    {'content': 'Yes, I know about them but need more practice'},\n    {'content': 'Yes, I am comfortable using lifecycle methods'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Soccer], generate a follow-up assessment question to determine the user's experience level. The question should help identify specific skills or knowledge areas related to soccer, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'What is your current level of soccer experience?',\n  'info': 'Soccer Skill Level',\n  'suggestAnswer': [\n    {'content': 'Beginner - I am new to soccer'},\n    {'content': 'Intermediate - I have some experience'},\n    {'content': 'Advanced - I play soccer regularly'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Soccer; Soccer Skill Level: Beginner - I am new to soccer], generate a follow-up assessment question to explore the user's interest in learning offensive or defensive skills. The question should help assess which aspect of the game the user wants to focus on. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you more interested in learning offensive or defensive soccer skills?',\n  'info': 'Offense vs. Defense Focus',\n  'suggestAnswer': [\n    {'content': 'Offensive skills'},\n    {'content': 'Defensive skills'},\n    {'content': 'Both'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Front-end Development], generate a follow-up assessment question to determine the user's experience level. The question should help identify specific skills or knowledge areas related to front-end development, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'What front-end technologies are you familiar with?',\n  'info': 'Front-end Technologies Familiarity',\n  'suggestAnswer': [\n    {'content': 'HTML, CSS, and JavaScript'},\n    {'content': 'React or Angular'},\n    {'content': 'I am new to front-end development'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Front-end Development], generate a follow-up assessment question to determine the user's experience level. The question should help identify specific skills or knowledge areas related to front-end development, and avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'What front-end technologies are you familiar with?',\n  'info': 'Front-end Technologies Familiarity',\n  'suggestAnswer': [\n    {'content': 'HTML, CSS, and JavaScript'},\n    {'content': 'React or Angular'},\n    {'content': 'I am new to front-end development'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Front-end Development; Experience Level: Beginner], generate a follow-up assessment question to determine the user's familiarity with design principles. The question should help identify any design knowledge related to front-end development. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Are you familiar with basic design principles for web interfaces?',\n  'info': 'Design Principles Understanding',\n  'suggestAnswer': [\n    {'content': 'Yes, I know about layouts and color schemes'},\n    {'content': 'I have some knowledge of UX/UI design'},\n    {'content': 'No, I have no knowledge of design principles'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Front-end Development; Experience Level: Beginner; Familiar with: HTML, CSS], generate a follow-up assessment question to determine the user's understanding of JavaScript. The question should avoid repeating any information already provided in the array. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'How would you rate your knowledge of JavaScript?',\n  'info': 'JavaScript Knowledge Level',\n  'suggestAnswer': [\n    {'content': 'I have a basic understanding'},\n    {'content': 'I have some experience'},\n    {'content': 'I have no knowledge of JavaScript'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Front-end Development; Experience Level: Beginner; Familiar with: HTML, CSS; JavaScript Knowledge: Basic], generate a follow-up assessment question to determine the user's experience with frameworks. The question should help assess which front-end frameworks the user has encountered. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'Have you worked with any front-end frameworks?',\n  'info': 'Front-end Framework Experience',\n  'suggestAnswer': [\n    {'content': 'Yes, I have worked with React or Vue'},\n    {'content': 'I have heard of them but not worked with any'},\n    {'content': 'No, I have only used vanilla JavaScript'}\n  ]\n}",
      },
      {
        text: "input: Based on the following information: [Want to study: Front-end Development; Experience Level: Beginner; Familiar with: HTML, CSS; JavaScript Knowledge: Basic; Frameworks: None], generate a follow-up assessment question to determine the user's goal for learning front-end development. The question should help assess the user's motivation. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information",
      },
      {
        text: "output: {\n  'nextQuestion': 'What is your primary goal for learning front-end development?',\n  'info': 'Learning Goals for Front-end Development',\n  'suggestAnswer': [\n    {'content': 'To build personal projects'},\n    {'content': 'To pursue a career in web development'},\n    {'content': 'To enhance my skills for my current job'}\n  ]\n}",
      },
      {
        text: `input: Based on the following information: [${generateQuestionRequest.info}], generate a follow-up assessment question to determine the user's goal for learning ${generateQuestionRequest.goal}. The question should help assess the user's motivation. Use the following JSON format:\n{\n  'nextQuestion': 'Your quiz question to assess proficiency',\n  'info': 'Your information summary',\n  'suggestAnswer': [\n    {'content': 'Answer A'},\n    {'content': 'Answer B'},\n    {'content': 'Answer C'}\n  ]\n}\nNote: Do not ask duplicate content already in information`,
      },
      { text: 'output: ' },
    ];

    const result = await model.generateContent({
      contents: [{ role: 'user', parts }],
      generationConfig,
    });
    console.log(result.response.text());

    const res = await result.response.text();

    const resJson = await JSON.parse(res);

    console.log(resJson);
    return resJson;
  }

  async generateRoadmap(info: string, userId: string) {
    const model = this.genAI.getGenerativeModel({
      model: 'gemini-1.5-pro-002',
    });

    const generationConfig = {
      temperature: 0,
      topP: 0.95,
      topK: 40,
      maxOutputTokens: 8192,
      responseMimeType: 'application/json',
    };

    const parts = [
      {
        text: 'input: Generate a structured learning roadmap in JSON format based on the specific learning objective provided in [Want to study: React; React Skill Level: Beginner - I have never used React; JSX Familiarity: No, I am not familiar with JSX; JavaScript ES6+ Knowledge: No, I am not familiar with ES6+; State and Props Knowledge: No, I am not familiar with state or props]. The roadmap should follow the Prisma schema below, containing at least three stages. Each stage must include a minimum of three tasks, each task must have at least three sub-tasks, and at least one sub-task in each task should contain a minimum of five quiz questions for knowledge checks. Each quiz should have multiple-choice options with one correct answer.\n\n**Roadmap Structure:**\n\nThe roadmap should be structured as follows:\n\n* **title**: Name of the roadmap\n* **stages:** Each stage represents a major phase in the learning journey.\n    * **name:** A descriptive name for the stage.\n    * **timeframe:** Estimated duration of the stage (e.g., "3 months").\n    * **tasks:** A list of tasks to be completed within the stage.\n* **tasks:** Each task represents a specific learning objective.\n    * **name:** A clear and concise name for the task.\n    * **description:** A detailed explanation of what the task entails.\n    * **time:** Estimated time required to complete the task.\n    * **subtasks:** A list of smaller, actionable steps to achieve the task.\n* **subtasks:**\n    * **name:** A descriptive name for the subtask.\n    * **description:** A brief explanation of the subtask.\n    * **resources:** \n           * **content:** Empty string\n           * **links:** Empty array\n    * **time:** Estimated time required to complete the subtask.\n    * **quizzes:** Empty array \n\n**Example JSON Structure:**\n\n{\n  "roadmap": {\n    "title": "Roadmap\'s name",\n    "stages": [\n      {\n        "name": "Stage 1 Name",\n        "timeframe": "3 months",\n        "tasks": [\n          {\n            "name": "Task 1 Name",\n            "description": "Task 1 Description",\n            "time": "1 month",\n            "subtasks": [{\n                "name": "Subtask 1 Name",\n                "description": "Subtask 1 Description",\n                "resources": {\n                   "content": "",\n                   "links": []\n                  },\n                "time": "1 week",\n                "quizzes": []\n              },\n              // ... more subtasks (minimum 4 subtasks)\n            ]\n          },\n          // ... more tasks (minimum 3 tasks)\n        ]\n      },\n      // ... more stages (minimum 3 stages)\n    ]\n  }\n}\n\n**Important Notes:**\n\n* Tailor the roadmap to the user\'s age, location, occupation, and specific goals.\n* Provide realistic timeframes and suggest relevant resources for each subtask.\n* Ensure the JSON output is well-formatted and easy to read.',
      },
      {
        text: 'output: {"roadmap": {"title": "React Learning Roadmap for Beginners", "stages": [{"name": "Stage 1: Introduction to JavaScript, JSX, and React Fundamentals", "timeframe": "4 weeks", "tasks": [{"name": "Task 1: Getting Started with JavaScript ES6+", "description": "Learn the basics of JavaScript ES6+.", "time": "1 week", "subtasks": [{"name": "Subtask 1: Variables, Data Types, and Operators", "description": "Understand variables, data types, and operators in JavaScript.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Subtask 2: Control Flow and Loops", "description": "Learn about control flow statements and loops in JavaScript.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Subtask 3: Functions and Scope", "description": "Understand functions and scope in JavaScript.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": [{"question": "What is the scope of a variable declared inside a function?", "options": ["Global", "Local", "Block", "None of the above"], "answer": "Local"}, {"question": "What is a closure in JavaScript?", "options": ["A function that returns another function", "A function that has access to variables from its outer scope", "A function that is declared inside another function", "All of the above"], "answer": "All of the above"}, {"question": "What is the difference between let and var?", "options": ["let is block-scoped, var is function-scoped", "let is function-scoped, var is block-scoped", "let can be reassigned, var cannot", "var can be reassigned, let cannot"], "answer": "let is block-scoped, var is function-scoped"}, {"question": "What is the purpose of the \'this\' keyword in JavaScript?", "options": ["It refers to the current object", "It refers to the global object", "It refers to the parent object", "It refers to the previous object"], "answer": "It refers to the current object"}, {"question": "What is a callback function?", "options": ["A function that is passed as an argument to another function", "A function that is called after a certain amount of time", "A function that is called when an event occurs", "A function that returns another function"], "answer": "A function that is passed as an argument to another function"}]}, {"name": "Subtask 4: Arrays and Objects", "description": "Learn about arrays and objects in JavaScript.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Subtask 5: Working with the DOM", "description": "Learn how to manipulate the Document Object Model (DOM).", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}]}, {"name": "Task 2: Introduction to JSX", "description": "Learn the basics of JSX.", "time": "1 week", "subtasks": [{"name": "Subtask 1: What is JSX?", "description": "Understand what JSX is and how it works.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Subtask 2: Embedding Expressions in JSX", "description": "Learn how to embed JavaScript expressions in JSX.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Subtask 3: JSX Attributes", "description": "Understand how to use attributes in JSX.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Subtask 4: JSX and HTML", "description": "Compare and contrast JSX with HTML.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Subtask 5: JSX Styling", "description": "Learn how to style JSX elements.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}]}, {"name": "Task 3: Building Your First React Components", "description": "Build your first React components.", "time": "2 weeks", "subtasks": [{"name": "Subtask 1: Setting up a Development Environment", "description": "Set up a development environment for React.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Subtask 2: Creating a Simple Component", "description": "Create a simple functional component in React.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Subtask 3: Creating a Class Component", "description": "Create a class component in React.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Subtask 4: Rendering Components", "description": "Learn how to render React components.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Subtask 5: Component Composition", "description": "Understand component composition in React.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}]}]}, {"name": "Stage 2: React State and Props", "timeframe": "3 weeks", "tasks": [{"name": "Understanding State", "description": "Learn how to use state in React components.", "time": "1 week", "subtasks": [{"name": "What is state?", "description": "Understand the concept of state in React.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Using setState()", "description": "Learn how to use the setState() method to update component state.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "State and Functional Components", "description": "Learn how to use state with functional components using the useState hook.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}]}, {"name": "Working with Props", "description": "Learn how to use props in React components.", "time": "1 week", "subtasks": [{"name": "What are props?", "description": "Understand the concept of props in React.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}, {"name": "Passing props to components", "description": "Learn how to pass props to child components.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Prop Validation", "description": "Learn how to validate props using PropTypes.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}]}, {"name": "State and Props Together", "description": "Learn how to use state and props together in React components.", "time": "1 week", "subtasks": [{"name": "Lifting state up", "description": "Understand when and how to lift state up to a parent component.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Passing props down", "description": "Learn how to pass props down to child components.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Building a simple application", "description": "Build a simple application using state and props.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}]}]}, {"name": "Stage 3: Advanced React Concepts and Project", "timeframe": "4 weeks", "tasks": [{"name": "Task 1: Lifecycle Methods", "description": "Learn about component lifecycle methods.", "time": "1 week", "subtasks": [{"name": "Mounting and Unmounting", "description": "Understand the componentDidMount and componentWillUnmount lifecycle methods.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Updating", "description": "Learn about the componentDidUpdate lifecycle method.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Error Handling", "description": "Learn about the componentDidCatch lifecycle method.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}]}, {"name": "Task 2: Working with Forms and Events", "description": "Learn how to work with forms and events in React.", "time": "1 week", "subtasks": [{"name": "Handling Events", "description": "Learn how to handle events in React.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Controlled Components", "description": "Understand controlled components in React forms.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Uncontrolled Components", "description": "Understand uncontrolled components in React forms.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": []}]}, {"name": "Task 3: Building a React Project", "description": "Build a more complex React project.", "time": "2 weeks", "subtasks": [{"name": "Project Planning", "description": "Plan your project and choose a topic.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}, {"name": "Project Implementation", "description": "Implement your project using the concepts you\'ve learned.", "resources": {"content": "", "links": []}, "time": "6 days", "quizzes": []}, {"name": "Project Deployment", "description": "Deploy your project to a web server or hosting platform.", "resources": {"content": "", "links": []}, "time": "2 days", "quizzes": []}]}]}]}}',
      },
      {
        text: 'input: Generate a structured learning roadmap in JSON format based on the specific learning objective provided in [Want to study: Guitar; Guitar Skill Level: Beginner - I have never played; Basic Chords Familiarity: No, I am not familiar; Preferred Playing Style: Fingerstyle; Interest in Music Theory: Yes, I want to learn the theory]. The roadmap should follow the Prisma schema below, containing at least three stages. Each stage must include a minimum of three tasks, each task must have at least three sub-tasks, and at least one sub-task in each task should contain a minimum of five quiz questions for knowledge checks. Each quiz should have multiple-choice options with one correct answer.\n\n**Roadmap Structure:**\n\nThe roadmap should be structured as follows:\n\n* **title**: Name of the roadmap\n* **stages:** Each stage represents a major phase in the learning journey.\n    * **name:** A descriptive name for the stage.\n    * **timeframe:** Estimated duration of the stage (e.g., "3 months").\n    * **tasks:** A list of tasks to be completed within the stage.\n* **tasks:** Each task represents a specific learning objective.\n    * **name:** A clear and concise name for the task.\n    * **description:** A detailed explanation of what the task entails.\n    * **time:** Estimated time required to complete the task.\n    * **subtasks:** A list of smaller, actionable steps to achieve the task.\n* **subtasks:**\n    * **name:** A descriptive name for the subtask.\n    * **description:** A brief explanation of the subtask.\n    * **resources:** \n           * **content:** Empty string\n           * **links:** Empty array\n    * **time:** Estimated time required to complete the subtask.\n    * **quizzes:** Empty array \n\n**Example JSON Structure:**\n\n{\n  "roadmap": {\n    "title": "Roadmap\'s name",\n    "stages": [\n      {\n        "name": "Stage 1 Name",\n        "timeframe": "3 months",\n        "tasks": [\n          {\n            "name": "Task 1 Name",\n            "description": "Task 1 Description",\n            "time": "1 month",\n            "subtasks": [{\n                "name": "Subtask 1 Name",\n                "description": "Subtask 1 Description",\n                "resources": {\n                   "content": "",\n                   "links": []\n                  },\n                "time": "1 week",\n                "quizzes": []\n              },\n              // ... more subtasks (minimum 4 subtasks)\n            ]\n          },\n          // ... more tasks (minimum 3 tasks)\n        ]\n      },\n      // ... more stages (minimum 3 stages)\n    ]\n  }\n}\n\n**Important Notes:**\n\n* Tailor the roadmap to the user\'s age, location, occupation, and specific goals.\n* Provide realistic timeframes and suggest relevant resources for each subtask.\n* Ensure the JSON output is well-formatted and easy to read.',
      },
      {
        text: 'output: {"roadmap": {"title": "Fingerstyle Guitar Learning Roadmap for Beginners", "stages": [{"name": "Stage 1: Foundational Skills", "timeframe": "2 months", "tasks": [{"name": "Task 1: Guitar Anatomy and Posture", "description": "Learn the parts of the guitar and proper playing posture.", "time": "1 week", "subtasks": [{"name": "Subtask 1: Parts of the Acoustic Guitar", "description": "Identify and name the different parts of an acoustic guitar.", "resources": {"content": "", "links": []}, "time": "1 day", "quizzes": [{"question": "What is the name of the wooden plate on the front of the guitar?", "options": ["Soundboard", "Back", "Sides", "Bridge"], "answer": "Soundboard"}, {"question": "What are the metal wires that run along the fretboard called?", "options": ["Frets", "Strings", "Tuning pegs", "Nuts"], "answer": "Frets"}, {"question": "What is the name of the long wooden piece where the frets are located?", "options": ["Fretboard", "Neck", "Headstock", "Body"], "answer": "Fretboard"}, {"question": "What is the name of the part that anchors the strings at the bottom of the guitar?", "options": ["Bridge", "Nut", "Saddle", "Tuning pegs"], "answer": "Bridge"}, {"question": "What are the metal parts used to tune the guitar called?", "options": ["Tuning pegs", "Machine heads", "Tuning keys", "All of the above"], "answer": "All of the above"}]}, {"name": "Subtask 2: Proper Posture and Hand Positioning", "description": "Learn how to hold the guitar and position your hands correctly.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}, {"name": "Subtask 3: Basic Finger Exercises", "description": "Perform exercises to improve finger strength and dexterity.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}]}, {"name": "Task 2: Music Theory Fundamentals", "description": "Learn basic music theory concepts.", "time": "2 weeks", "subtasks": [{"name": "Subtask 1: Notes and Intervals", "description": "Understand musical notes, scales, and intervals.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}, {"name": "Subtask 2: Rhythms and Time Signatures", "description": "Learn about rhythm, time signatures, and note values.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}, {"name": "Subtask 3: Basic Chords and Harmony", "description": "Understand basic chord construction and harmony.", "resources": {"content": "", "links": []}, "time": "4 days", "quizzes": [{"question": "What is a chord?", "options": ["Three or more notes played together", "A single note played on the guitar", "A sequence of notes played one after another", "A type of guitar"], "answer": "Three or more notes played together"}, {"question": "What is a major chord?", "options": ["A chord with a happy sound", "A chord with a sad sound", "A chord with only two notes", "A chord played on a major scale"], "answer": "A chord with a happy sound"}, {"question": "What is a minor chord?", "options": ["A chord with a sad sound", "A chord with a happy sound", "A chord with only two notes", "A chord played on a minor scale"], "answer": "A chord with a sad sound"}, {"question": "What is the root note of a chord?", "options": ["The note that the chord is built upon", "The highest note in the chord", "The lowest note in the chord", "The middle note in the chord"], "answer": "The note that the chord is built upon"}, {"question": "What is an interval?", "options": ["The distance between two notes", "The length of a note", "The volume of a note", "The speed of a note"], "answer": "The distance between two notes"}]}]}, {"name": "Task 3: Fingerpicking Patterns", "description": "Learn basic fingerpicking patterns.", "time": "2 weeks", "subtasks": [{"name": "Subtask 1: Alternating Thumb and Index Finger", "description": "Practice alternating between thumb and index finger.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}, {"name": "Subtask 2: The \'P-I-M-A\' Fingerpicking Pattern", "description": "Learn and practice the P-I-M-A fingerpicking pattern.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}, {"name": "Subtask 3: Combining Patterns with Simple Chords", "description": "Practice playing simple chords with the learned fingerpicking patterns.", "resources": {"content": "", "links": []}, "time": "4 days", "quizzes": []}]}]}, {"name": "Stage 2: Intermediate Techniques", "timeframe": "3 months", "tasks": [{"name": "Task 1: Barre Chords", "description": "Learn and practice barre chords.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: E-Shape Barre Chords", "description": "Learn the E-shape barre chord.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: A-Shape Barre Chords", "description": "Learn the A-shape barre chord.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 3: Barre Chord Transitions", "description": "Practice transitioning between different barre chords.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}]}, {"name": "Task 2: Travis Picking", "description": "Learn and practice Travis picking.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Basic Travis Picking Pattern", "description": "Learn the basic Travis picking pattern.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Travis Picking Variations", "description": "Explore variations of the Travis picking pattern.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Travis Picking with Chords", "description": "Practice Travis picking with different chords.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}, {"name": "Task 3: Arpeggios", "description": "Learn and practice arpeggios.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Basic Arpeggio Patterns", "description": "Learn basic arpeggio patterns.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Arpeggios with Chords", "description": "Practice playing arpeggios with different chords.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Creating Arpeggio Melodies", "description": "Practice creating simple melodies using arpeggios.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}]}, {"name": "Stage 3: Advanced Skills and Song Learning", "timeframe": "4 months", "tasks": [{"name": "Task 1: Advanced Fingerstyle Techniques", "description": "Learn advanced fingerstyle techniques.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Percussive Fingerstyle", "description": "Learn percussive fingerstyle techniques.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Hybrid Picking", "description": "Learn hybrid picking techniques.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Combining Techniques", "description": "Practice combining different fingerstyle techniques.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}, {"name": "Task 2: Learning Songs", "description": "Learn to play fingerstyle songs.", "time": "8 weeks", "subtasks": [{"name": "Subtask 1: Choosing Songs", "description": "Choose fingerstyle songs that match your skill level.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Practicing Songs", "description": "Practice the chosen songs regularly.", "resources": {"content": "", "links": []}, "time": "6 weeks", "quizzes": []}, {"name": "Subtask 3: Performing Songs", "description": "Perform the learned songs for an audience.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}, {"name": "Task 3: Improvisation and Composition", "description": "Learn to improvise and compose fingerstyle pieces.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Improvising over Chords", "description": "Practice improvising over different chord progressions.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Composing Simple Melodies", "description": "Practice composing simple fingerstyle melodies.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Creating a Fingerstyle Arrangement", "description": "Create a fingerstyle arrangement of a simple song.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}]}]}}',
      },
      {
        text: 'input: Generate a structured learning roadmap in JSON format based on the specific learning objective provided in [Want to study: Drawing; Drawing Experience Level: Beginner - I have never practiced drawing seriously; Basic Drawing Techniques: No, I am not familiar with these techniques; Preferred Drawing Subject: Anatomy drawing; Familiarity with Drawing Tools: Pencils]. The roadmap should follow the Prisma schema below, containing at least three stages. Each stage must include a minimum of three tasks, each task must have at least three sub-tasks, and at least one sub-task in each task should contain a minimum of five quiz questions for knowledge checks. Each quiz should have multiple-choice options with one correct answer.\n\n**Roadmap Structure:**\n\nThe roadmap should be structured as follows:\n\n* **title**: Name of the roadmap\n* **stages:** Each stage represents a major phase in the learning journey.\n    * **name:** A descriptive name for the stage.\n    * **timeframe:** Estimated duration of the stage (e.g., "3 months").\n    * **tasks:** A list of tasks to be completed within the stage.\n* **tasks:** Each task represents a specific learning objective.\n    * **name:** A clear and concise name for the task.\n    * **description:** A detailed explanation of what the task entails.\n    * **time:** Estimated time required to complete the task.\n    * **subtasks:** A list of smaller, actionable steps to achieve the task.\n* **subtasks:**\n    * **name:** A descriptive name for the subtask.\n    * **description:** A brief explanation of the subtask.\n    * **resources:** \n           * **content:** Empty string\n           * **links:** Empty array\n    * **time:** Estimated time required to complete the subtask.\n    * **quizzes:** Empty array \n\n**Example JSON Structure:**\n\n{\n  "roadmap": {\n    "title": "Roadmap\'s name",\n    "stages": [\n      {\n        "name": "Stage 1 Name",\n        "timeframe": "3 months",\n        "tasks": [\n          {\n            "name": "Task 1 Name",\n            "description": "Task 1 Description",\n            "time": "1 month",\n            "subtasks": [{\n                "name": "Subtask 1 Name",\n                "description": "Subtask 1 Description",\n                "resources": {\n                   "content": "",\n                   "links": []\n                  },\n                "time": "1 week",\n                "quizzes": []\n              },\n              // ... more subtasks (minimum 4 subtasks)\n            ]\n          },\n          // ... more tasks (minimum 3 tasks)\n        ]\n      },\n      // ... more stages (minimum 3 stages)\n    ]\n  }\n}\n\n**Important Notes:**\n\n* Tailor the roadmap to the user\'s age, location, occupation, and specific goals.\n* Provide realistic timeframes and suggest relevant resources for each subtask.\n* Ensure the JSON output is well-formatted and easy to read.',
      },
      {
        text: 'output: {"roadmap": {"title": "Anatomy Drawing Roadmap for Beginners", "stages": [{"name": "Stage 1: Fundamental Drawing Skills", "timeframe": "2 months", "tasks": [{"name": "Task 1: Basic Shapes and Forms", "description": "Learn to draw basic shapes and forms, the foundation of any drawing.", "time": "2 weeks", "subtasks": [{"name": "Subtask 1: Lines and Contours", "description": "Practice drawing various types of lines and contours.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": [{"question": "What is a contour line?", "options": ["A line that defines the edges and curves of an object", "A line that shows the direction of light", "A line that creates shading", "A line that represents movement"], "answer": "A line that defines the edges and curves of an object"}, {"question": "What is a blind contour drawing?", "options": ["Drawing without looking at the paper", "Drawing with your eyes closed", "Drawing from memory", "Drawing with a single continuous line"], "answer": "Drawing without looking at the paper"}, {"question": "What is cross-contour drawing?", "options": ["Drawing lines that follow the curves and form of the subject", "Drawing lines that intersect each other", "Drawing lines that create shading", "Drawing lines that represent movement"], "answer": "Drawing lines that follow the curves and form of the subject"}, {"question": "What is a gesture drawing?", "options": ["A quick sketch that captures the essence of a pose or movement", "A detailed drawing of a stationary object", "A drawing that focuses on light and shadow", "A drawing that uses color to create mood"], "answer": "A quick sketch that captures the essence of a pose or movement"}, {"question": "What is the purpose of practicing line variations?", "options": ["To create visual interest and depth in a drawing", "To make the drawing look more realistic", "To improve hand-eye coordination", "All of the above"], "answer": "All of the above"}]}, {"name": "Subtask 2: Cubes and Rectangular Prisms", "description": "Practice drawing cubes and rectangular prisms in different perspectives.", "resources": {"content": "", "links": []}, "time": "4 days", "quizzes": []}, {"name": "Subtask 3: Spheres and Cylinders", "description": "Practice drawing spheres and cylinders in different perspectives.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}]}, {"name": "Task 2: Light and Shadow", "description": "Learn how light and shadow affect the appearance of forms.", "time": "2 weeks", "subtasks": [{"name": "Subtask 1: Understanding Light Sources", "description": "Learn about different types of light sources and their effects.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}, {"name": "Subtask 2: Shading Techniques", "description": "Practice different shading techniques like hatching, cross-hatching, and blending.", "resources": {"content": "", "links": []}, "time": "4 days", "quizzes": []}, {"name": "Subtask 3: Creating Depth and Form with Shading", "description": "Apply shading to create the illusion of depth and three-dimensionality.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}]}, {"name": "Task 3: Perspective Drawing", "description": "Learn the basics of perspective to create depth in your drawings.", "time": "2 weeks", "subtasks": [{"name": "Subtask 1: One-Point Perspective", "description": "Practice drawing objects in one-point perspective.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}, {"name": "Subtask 2: Two-Point Perspective", "description": "Practice drawing objects in two-point perspective.", "resources": {"content": "", "links": []}, "time": "4 days", "quizzes": []}, {"name": "Subtask 3: Applying Perspective to Simple Objects", "description": "Draw everyday objects using perspective principles.", "resources": {"content": "", "links": []}, "time": "3 days", "quizzes": []}]}]}, {"name": "Stage 2: Introduction to Anatomy Drawing", "timeframe": "3 months", "tasks": [{"name": "Task 1: Skeletal Structure", "description": "Learn the basic skeletal structure of the human body.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Major Bones and Joints", "description": "Identify and draw the major bones and joints of the body.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Proportions of the Skeleton", "description": "Understand and practice drawing the proportions of the human skeleton.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Skeleton in Different Poses", "description": "Practice drawing the skeleton in various dynamic poses.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}, {"name": "Task 2: Muscle Groups", "description": "Learn the major muscle groups of the human body.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Identifying Major Muscle Groups", "description": "Identify and draw the major muscle groups of the body.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Muscles and Their Function", "description": "Understand how different muscle groups contribute to movement and form.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Drawing Muscles in Different Poses", "description": "Practice drawing muscle groups in various dynamic poses.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}, {"name": "Task 3: Figure Drawing", "description": "Combine skeletal and muscular knowledge to draw the human figure.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Proportions of the Human Figure", "description": "Practice drawing the human figure with correct proportions.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Figure Drawing from Reference", "description": "Practice drawing the human figure from photo references.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Figure Drawing from Life", "description": "Practice drawing the human figure from life, if possible.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}]}, {"name": "Stage 3: Advanced Anatomy and Dynamic Poses", "timeframe": "4 months", "tasks": [{"name": "Task 1: Dynamic Poses and Foreshortening", "description": "Learn to draw the human figure in dynamic poses and foreshortening.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Understanding Foreshortening", "description": "Learn the principles of foreshortening and how to apply them to figure drawing.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Drawing Dynamic Poses from Reference", "description": "Practice drawing dynamic poses from photo references.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Drawing Dynamic Poses from Life", "description": "Practice drawing dynamic poses from life, if possible.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}, {"name": "Task 2: Hands and Feet", "description": "Focus on drawing the intricate details of hands and feet.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Anatomy of Hands and Feet", "description": "Study the anatomy and structure of hands and feet.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Drawing Hands from Reference", "description": "Practice drawing hands from various angles and poses using references.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Drawing Feet from Reference", "description": "Practice drawing feet from various angles and poses using references.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}, {"name": "Task 3: Facial Anatomy and Expressions", "description": "Learn to draw the human face with accurate anatomy and expressions.", "time": "4 weeks", "subtasks": [{"name": "Subtask 1: Facial Proportions and Features", "description": "Study the proportions and features of the human face.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}, {"name": "Subtask 2: Drawing Facial Expressions", "description": "Practice drawing a range of facial expressions.", "resources": {"content": "", "links": []}, "time": "2 weeks", "quizzes": []}, {"name": "Subtask 3: Portraits from Reference", "description": "Practice drawing portraits from photo references.", "resources": {"content": "", "links": []}, "time": "1 week", "quizzes": []}]}]}]}}',
      },
      {
        text: `input: Generate a structured learning roadmap in JSON format based on the specific learning objective provided in [${info}]. The roadmap should follow the Prisma schema below, containing at least three stages. Each stage must include a minimum of three tasks, each task must have at least three sub-tasks, and at least one sub-task in each task should contain a minimum of five quiz questions for knowledge checks. Each quiz should have multiple-choice options with one correct answer.\n\n**Roadmap Structure:**\n\nThe roadmap should be structured as follows:\n\n* **title**: Name of the roadmap\n* **stages:** Each stage represents a major phase in the learning journey.\n    * **name:** A descriptive name for the stage.\n    * **timeframe:** Estimated duration of the stage (e.g., "3 months").\n    * **tasks:** A list of tasks to be completed within the stage.\n* **tasks:** Each task represents a specific learning objective.\n    * **name:** A clear and concise name for the task.\n    * **description:** A detailed explanation of what the task entails.\n    * **time:** Estimated time required to complete the task.\n    * **subtasks:** A list of smaller, actionable steps to achieve the task.\n* **subtasks:**\n    * **name:** A descriptive name for the subtask.\n    * **description:** A brief explanation of the subtask.\n    * **resources:** \n           * **content:** Empty string\n           * **links:** Empty array\n    * **time:** Estimated time required to complete the subtask.\n    * **quizzes:** Empty array \n\n**Example JSON Structure:**\n\n{\n  "roadmap": {\n    "title": "Roadmap\'s name",\n    "stages": [\n      {\n        "name": "Stage 1 Name",\n        "timeframe": "3 months",\n        "tasks": [\n          {\n            "name": "Task 1 Name",\n            "description": "Task 1 Description",\n            "time": "1 month",\n            "subtasks": [{\n                "name": "Subtask 1 Name",\n                "description": "Subtask 1 Description",\n                "resources": {\n                   "content": "",\n                   "links": []\n                  },\n                "time": "1 week",\n                "quizzes": []\n              },\n              // ... more subtasks (minimum 4 subtasks)\n            ]\n          },\n          // ... more tasks (minimum 3 tasks)\n        ]\n      },\n      // ... more stages (minimum 3 stages)\n    ]\n  }\n}\n\n**Important Notes:**\n\n* Tailor the roadmap to the user\'s age, location, occupation, and specific goals.\n* Provide realistic timeframes and suggest relevant resources for each subtask.\n* Ensure the JSON output is well-formatted and easy to read.`,
      },
      { text: 'output: ' },
    ];

    const result = await model.generateContent({
      contents: [{ role: 'user', parts }],
      generationConfig,
    });
    console.log('hererere:', result.response.text());

    const res = await result.response.text();

    const resJson = await JSON.parse(res);

    //Send to topic to receive user detail
    const roadmap = await this.prismaService.roadmap.create({
      data: {
        userId,
        title: resJson.roadmap.title,
        stages: [...resJson.roadmap.stages],
      },
    });

    console.log(resJson);
    return roadmap;
  }

  async getRoadmapById(id: string, userId: string) {
    try {
      return this.prismaService.roadmap.findUnique({
        where: {
          id,
          userId,
        },
      });
    } catch (error) {
      console.log(error);
      throw new NotFoundException('Roadmap not found');
    }
  }

  async getRoadmapsByUserId(userId: string) {
    return this.prismaService.roadmap.findMany({
      where: {
        userId,
      },
    });
  }

  async deleteRoadmapById(id: string, userId: string) {
    const roadmap = await this.prismaService.roadmap.findUnique({
      where: {
        id,
        userId,
      },
    });

    if (!roadmap) {
      throw new NotFoundException('Roadmap not found');
    }

    return this.prismaService.roadmap.delete({
      where: {
        id,
      },
    });
  }

  test() {
    console.log('running...');
    console.log('info:', this.configService.get('JWT_SECRET'));
    this.configService.get('GOOGLE_CLIENT_ID');
    return 'running...';
  }
}
